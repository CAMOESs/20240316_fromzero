import{r as o,p as Z,b as _,d as j,f as r,w as m,g as B,x as D,y as E,h as a,j as ee,m as k,z as x,F as M,e as C,o as f,l as I,k as ae,v as te,i as le}from"./entry.febd1464.js";const ne=C("br",null,null,-1),ie=C("br",null,null,-1),se={class:"mx-2 mb-14"},oe={key:0},_e={__name:"signataires",async setup(re){let V,N;const{$caxios:$}=te();let g=o({}),l=o({});o(null);let c=o({});o(1);async function T(e){e.target.files[0],l.value[`${e.target.id}`].sign=e.target.files[0]}let A=o(""),O=o({}),w=o(0);const t=o([]);t.value=([V,N]=Z(()=>$("/signataire/")),V=await V,N(),V);let i=t.value?t.value.length:0,U=o(!1),z=o(!1),p=o(!1),b=o();b.value=i>0;let Y=async e=>{z.value=!1;let u=Object.keys(l.value);c=new FormData,i>0&&t.value.forEach(n=>{c.append(`signature_url_${n.signataire-1}`,n.signature_url)}),i!=g.value.nbr_sign&&(i=g.value.nbr_sign),u.forEach(n=>{c.append(`title_of_sign_${n}`,l.value[n].title_of_sign),c.append(`showed_${n}`,l.value[n].showed),c.append("nbr",i),l.value[n].sign?c.append(`items.value[${n}].sign`,l.value[n].sign):l.value[n].sign="",O.value[n]=l.value[n],c.append(`${n}`,"ttr")}),await le("/api/signataire/",{method:"POST",body:c},"$ewTbmvwbYc"),t.value=await $("/signataire/"),i=t.value.length,b.value=!0,S()};function q(e){e.showimg=!e.showimg}let S=()=>{if(i>0){g.value.nbr_sign=i,w.value=i,U.value=!0,l.value={};for(let e=0;e<w.value;e++)l.value["signataire_"+e]={title_of_sign:i!=0&&t.value[e]?t.value[e].title_of_sign:"",showed:i!=0&&t.value[e]?t.value[e].showed=="true":!1,signature_url:i!=0&&t.value[e]?t.value[e].signature_url:"",exe:i!=0&&t.value[e]?t.value[e].exe:"",showimg:!1}}};S();let L=async()=>{U.value=!0,A.value="",i>0?(t.value=await $("/signataire/"),i<g.value.nbr_sign?b.value=!1:b.value=!0):(t.value=[],b.value=!1),l.value={},w.value=parseInt(g.value.nbr_sign)||0;for(let e=0;e<w.value;e++)l.value["signataire_"+e]={title_of_sign:i!=0&&t.value[e]?t.value[e].title_of_sign:"",showed:i!=0&&t.value[e]?t.value[e].showed=="true":!1,signature_url:i!=0&&t.value[e]?t.value[e].signature_url:"",exe:i!=0&&t.value[e]?t.value[e].exe:"",showImg:!1}},P=(e,u)=>{let n=Object.values(e),d=o(!1);if(u){for(let v=0;v<n.length;v++)if(!n[v].title_of_sign||!n[v].sign){d.value=!0;break}return d.value}else{for(let v=0;v<n.length;v++)if(!n[v].title_of_sign){d.value=!0;break}return d.value}};return(e,u)=>{const n=_("v-text-field"),d=_("v-btn"),v=_("v-form"),F=_("v-switch"),R=_("v-toolbar"),G=_("v-file-input"),H=_("v-img"),J=_("v-card-text"),K=_("v-card"),Q=_("v-col"),W=_("v-row"),X=_("v-card-actions");return f(),j(M,null,[ne,ie,r(v,{onSubmit:u[1]||(u[1]=B(()=>{},["prevent"]))},{default:m(()=>[r(n,{label:"Nombre de signataire ",modelValue:a(g).nbr_sign,"onUpdate:modelValue":u[0]||(u[0]=y=>a(g).nbr_sign=y),modelModifiers:{trim:!0},type:"number",min:"1",max:"3",variant:"outlined",class:"mx-2"},null,8,["modelValue"]),C("div",se,[r(d,{variant:"flat",type:"submit",block:"",color:"light-blue-darken-4 ",disabled:a(g).nbr_sign>3||a(g).nbr_sign==0||!a(g).nbr_sign,onClick:a(L)},{default:m(()=>[I("Valider")]),_:1},8,["disabled","onClick"])])]),_:1}),D(r(F,{class:"my-10 ml-2 custom-switch",color:"#00e676",modelValue:a(p),"onUpdate:modelValue":u[2]||(u[2]=y=>ee(p)?p.value=y:p=y),density:"compact",label:"Mise a jour sans import d'image","label-placement":"right"},null,8,["modelValue"]),[[E,a(b)]]),a(U)?(f(),k(v,{key:0,onSubmit:u[3]||(u[3]=B(()=>{},["prevent"]))},{default:m(()=>[(f(!0),j(M,null,ae(a(w),(y,s)=>(f(),k(K,{style:{transform:"translateY(-40px)"},class:"ma-2",key:s},{default:m(()=>[r(R,{class:"text-center",title:`Signataire N° ${s+1}`},null,8,["title"]),r(J,null,{default:m(()=>[C("div",null,[r(n,{label:"Titre *",modelValue:a(l)["signataire_"+s].title_of_sign,"onUpdate:modelValue":h=>a(l)["signataire_"+s].title_of_sign=h,modelModifiers:{trim:!0},type:"text",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"]),D(r(G,{modelValue:a(l)["signataire_"+s].sign,"onUpdate:modelValue":h=>a(l)["signataire_"+s].sign=h,accept:"image/png, image/jpeg, image/bmp","prepend-inner-icon":"mdi-camera","prepend-icon":"",label:"Signature image à télécharger *",id:"signataire_"+s,ref_for:!0,ref:"imageFile",onChange:T},null,8,["modelValue","onUpdate:modelValue","id"]),[[E,!a(p)]]),a(i)>0?(f(),j("div",oe,[a(l)["signataire_"+s].signature_url?(f(),k(d,{key:0,onClick:h=>q(a(l)["signataire_"+s]),variant:"plain"},{default:m(()=>[I(" cliquez ici pour voir l'image enregistrée ")]),_:2},1032,["onClick"])):x("",!0),a(l)["signataire_"+s].showimg?(f(),k(H,{key:1,src:`/api/showphoto?t=signataire_${s}.${a(l)["signataire_"+s].exe}`,style:{width:"300px",height:"300px","margin-left":"auto","margin-right":"auto"}},null,8,["src"])):x("",!0)])):x("",!0),r(F,{modelValue:a(l)["signataire_"+s].showed,"onUpdate:modelValue":h=>a(l)["signataire_"+s].showed=h,class:"mt-0 ml-2 custom-switch",color:"#00e676",density:"compact",label:"Afficher la signature","label-placement":"right"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),_:2},1024))),128)),r(X,null,{default:m(()=>[r(W,null,{default:m(()=>[r(Q,{cols:"12",sm:"12"},{default:m(()=>[r(d,{variant:"flat",type:"submit",block:"",color:"light-blue-darken-4 ",disabled:a(P)(a(l),!a(p)),onClick:a(Y)},{default:m(()=>[I("Enregistrer")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0)],64)}}};export{_e as default};

import{u as B,p as U,r as u,b as v,d as N,h as e,m as E,w as c,z as x,f as s,a as M,o as b,l as S,F as I,x as T,y as O,e as q,i as g}from"./entry.febd1464.js";const A={class:"pt-10"},G=q("span",{class:"d-none d-xs-none d-sm-block"},"Modifier",-1),H={__name:"mon-compte",async setup(Y){let i,f,m=B();const o=([i,f]=U(()=>M()),i=await i,f(),i),t=u({});u("");const p=u(!0),k=u(null),d=u("Ce champ est obligatoire"),_=u(!1),y=u(!1);u({number:"",valid:!0}),u(!0),t.value.id=o.data.value.user.personal_id;function $(){p.value=!1}function V(){return!(o&&o.data&&o.data.value&&o.data.value.user&&(o.data.value.user.student_id||o.data.value.user.personal_id))}async function h(){try{if(V()&&o&&o.data&&o.data.value&&o.data.value.user&&o.data.value.user.id){const{error:n,data:l}=await g("/api/users/my-account?id="+o.data.value.user.id,"$uUEnpUFsrC");(!n||!n.value)&&l.value.length>0?(l.value[0].date_of_birth=new Date(l.value[0].date_of_birth).toLocaleDateString("af"),t.value=l.value[0]):m.error("Nous n'avons pas pu effectuer l'opération demandée. Veuillez actualiser la page et réessayer. ")}}catch{}}[i,f]=U(()=>h()),await i,f();async function D(){if((await k.value.validate()).valid)try{if(o&&o.data&&o.data.value&&o.data.value.user&&o.data.value.user.school_id||!V()){const{error:n,data:l}=await g("/api/my-account-school",{method:"POST",body:{...t.value,password:t.value.password,confirm_password:t.value.confirm_password}},"$ih968LuDcp");!n||!n.value?(p.value=!0,m.success("Enregistrement éffectué avec succès")):(console.log(n.value),m.error("Enregistrement échoué"))}else if(o&&o.data&&o.data.value&&o.data.value.user&&o.data.value.user.id){const{error:n,data:l}=await g("/api/users/my-account",{method:"POST",body:{...t.value,id:o.data.value.user.id}},"$YIgs5SrC8G");!n||!n.value?(p.value=!0,m.success("Enregistrement éffectué avec succès")):m.error("Enregistrement échoué")}}catch{}}return(n,l)=>{const F=v("v-icon"),C=v("v-btn"),r=v("v-text-field"),L=v("v-select"),P=v("v-form"),z=v("v-card");return b(),N("div",A,[e(p)?(b(),E(C,{key:0,class:"mx-2 mt-6",style:{color:"white"},onClick:l[0]||(l[0]=w=>$()),color:"#093e73"},{default:c(()=>[s(F,null,{default:c(()=>[S(" mdi mdi-pencil ")]),_:1}),G]),_:1})):x("",!0),s(z,{class:"mx-2 mb-6 mt-3"},{default:c(()=>[s(P,{ref_key:"form",ref:k,class:"ma-3",disabled:e(p)},{default:c(()=>{var w;return[V()?(b(),N(I,{key:0},[s(r,{modelValue:e(t).lastname,"onUpdate:modelValue":l[1]||(l[1]=a=>e(t).lastname=a),label:"Nom *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).firstname,"onUpdate:modelValue":l[2]||(l[2]=a=>e(t).firstname=a),label:"Prénoms *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).email,"onUpdate:modelValue":l[3]||(l[3]=a=>e(t).email=a),label:"Email *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(L,{modelValue:e(t).sex,"onUpdate:modelValue":l[4]||(l[4]=a=>e(t).sex=a),items:["M","F"],rules:[a=>!!a||e(d)],clearable:"","deletable-chips":"",variant:"outlined",label:"Sexe *"},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).phone_number,"onUpdate:modelValue":l[5]||(l[5]=a=>e(t).phone_number=a),label:"Numéro de téléphone *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).place_of_birth,"onUpdate:modelValue":l[6]||(l[6]=a=>e(t).place_of_birth=a),label:"Lieu de naissance *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).nationality,"onUpdate:modelValue":l[7]||(l[7]=a=>e(t).nationality=a),label:"Nationalité *",variant:"outlined",type:"text",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"]),s(r,{modelValue:e(t).date_of_birth,"onUpdate:modelValue":l[8]||(l[8]=a=>e(t).date_of_birth=a),label:"Date de naissance *",variant:"outlined",type:"date",rules:[a=>!!a||e(d)]},null,8,["modelValue","rules"])],64)):x("",!0),s(r,{modelValue:e(t).password,"onUpdate:modelValue":[l[9]||(l[9]=a=>e(t).password=a),l[11]||(l[11]=a=>e(t).password?"":e(t).confirm_password="")],modelModifiers:{trim:!0},label:"Mot de passe","append-inner-icon":e(_)?"mdi-eye":"mdi-eye-off",type:e(_)?"text":"password","onClick:appendInner":l[10]||(l[10]=a=>_.value=!e(_)),variant:"outlined",messages:"Les espaces au début et à la fin ne sont pas considérés"},null,8,["modelValue","append-inner-icon","type"]),(w=e(t).password)!=null&&w.trim()?(b(),E(r,{key:1,"append-inner-icon":e(y)?"mdi-eye":"mdi-eye-off",type:e(y)?"text":"password",modelValue:e(t).confirm_password,"onUpdate:modelValue":l[12]||(l[12]=a=>e(t).confirm_password=a),label:"Confirmation du mot de passe *",variant:"outlined","onClick:appendInner":l[13]||(l[13]=a=>y.value=!e(y)),rules:[a=>a===e(t).password||"Le mot de passe ne correspond pas"],color:e(t).confirm_password==e(t).password?"green":"blue"},null,8,["append-inner-icon","type","modelValue","rules","color"])):x("",!0),T(s(C,{onClick:l[14]||(l[14]=a=>D()),elevation:5,block:"",class:"mt-2",style:{color:"white"},color:"#093e73"},{default:c(()=>[S("Enregistrer")]),_:1},512),[[O,!e(p)]])]}),_:1},8,["disabled"])]),_:1})])}}};export{H as default};

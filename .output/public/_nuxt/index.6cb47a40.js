import{_ as J}from"./table.665c22b5.js";import{q as K,u as Q,r as m,p as L,b as c,d as A,e as i,f as l,w as o,h as a,j as p,o as $,l as f,t as S,g as X,v as Y,i as j}from"./entry.febd1464.js";const ee={class:"mt-4"},te=i("span",{class:"d-none d-xs-none d-sm-block"},"Ajouter",-1),le=i("span",{class:"d-none d-xs-none d-sm-block"},"Modifier",-1),ae=i("span",{class:"d-none d-xs-none d-sm-block"},"Supprimer",-1),oe={style:{"text-align":"center"}},se={style:{"text-align":"center"}},ne={style:{"text-align":"center"}},de=i("div",null,null,-1),ie={key:0,class:"text-h5"},ue={key:1,class:"text-h5"},re={class:"d-flex justify-end"},me=i("div",null,null,-1),ve=i("span",{class:"text-h5"},"Suppression ",-1),_e={class:"pb-5 px-3"},fe={class:"d-flex justify-end"},ye={__name:"index",async setup(ce){let y,w;const{$caxios:P,$dateformatFr:R}=Y();K({title:"Liste des sessions"});let g=Q(),v=m([]),V=m([]),s=m({}),D=m([]),u=m(!1),_=m(!1),k=m(!1),h=m(!1),E=m(!1),b=m(!1),M=m("/api/sessions/");D.value=([y,w]=L(()=>P("/sessions/months")),y=await y,w(),y);const q=m([{key:"numero",text:"N°",active_modif_column:!0},{key:"session",text:"Session",active_modif_column:!0},{key:"reference",text:"Référence",active_modif_column:!1},{key:"date_of_pv",text:"Date de PV",active_modif_column:!0},{key:"description",text:"Description",active_modif_column:!1}]),N=m("Veuillez renseigner ce champ.");async function U(){var e;let n={};E.value=!0,v.value=[];try{n=await j(M,"$uStAF8DuvP"),V.value=n.data.value}catch(r){console.log(r),g.error((e=n.data.value)==null?void 0:e.error)}E.value=!1}async function I(){var e,r,d;let n={};h.value=!0;try{if(n=await j(M,{method:"DELETE",body:{ids:v.value.map(x=>x.id)}},"$tsiMB5ZOyc"),(e=n.data.value)!=null&&e.error)throw"";await U(),_.value=!1,g.success()}catch(x){console.log(x),g.error((d=(r=n==null?void 0:n.data)==null?void 0:r.value)==null?void 0:d.error)}h.value=!1}async function H(){var e,r,d;if(!b.value)return;k.value=!0;let n={};try{if(n=await j(M,{method:"POST",body:s},"$zMNtWVLzeh"),(e=n.data.value)!=null&&e.error)throw"";s.id,await U(),u.value=!1,v.value=[],g.success()}catch(x){console.log(x),g.error((d=(r=n==null?void 0:n.data)==null?void 0:r.value)==null?void 0:d.error)}k.value=!1}function W(){_.value=!0}function F(n){n?(s.value={},u.value=!0):Array.isArray(v.value)&&v.value[0]&&(s.value=Object.assign({},v.value[0]),s.value.date_of_pv=s.value.date_of_pv?s.value.date_of_pv.split("T")[0]:null,u.value=!0)}return[y,w]=L(()=>U()),await y,w(),(n,e)=>{const r=c("v-icon"),d=c("v-btn"),x=J,T=c("v-card-title"),Z=c("v-autocomplete"),C=c("v-text-field"),G=c("v-form"),B=c("v-card-text"),O=c("v-card"),z=c("v-dialog");return $(),A("div",ee,[i("div",null,[l(d,{class:"mr-1",style:{color:"white"},color:"#093e73",onClick:e[0]||(e[0]=t=>F(!0))},{default:o(()=>[l(r,null,{default:o(()=>[f("mdi-plus")]),_:1}),te]),_:1}),l(d,{class:"mr-1",style:{color:"white"},color:"#093e73",disabled:a(v).length!=1,onClick:e[1]||(e[1]=t=>F(!1))},{default:o(()=>[l(r,null,{default:o(()=>[f("mdi-pencil ")]),_:1}),le]),_:1},8,["disabled"]),l(d,{class:"mr-1",style:{color:"white"},color:"#093e73",disabled:a(v).length==0,onClick:e[2]||(e[2]=t=>W())},{default:o(()=>[l(r,null,{default:o(()=>[f("mdi-delete ")]),_:1}),ae]),_:1},8,["disabled"])]),l(x,{with_selected:!0,selected:a(v),"onUpdate:selected":e[3]||(e[3]=t=>p(v)?v.value=t:v=t),items:a(V),"onUpdate:items":e[4]||(e[4]=t=>p(V)?V.value=t:V=t),header:a(q),expanded:!1,no_data:"Aucune donnée disponible!"},{"item(numero)":o(({index:t})=>[i("div",oe,S(t+1),1)]),"item(session)":o(({elt_item:t})=>[i("div",se,S(t.Month&&t.Month.name?t.Month.name:"-"),1)]),"item(date_of_pv)":o(({elt_item:t})=>[i("div",ne,S(a(R)(t.date_of_pv)),1)]),_:1},8,["selected","items","header"]),i("div",null,[l(z,{modelValue:a(u),"onUpdate:modelValue":e[14]||(e[14]=t=>p(u)?u.value=t:u=t),persistent:""},{default:o(()=>[l(O,null,{default:o(()=>[de,l(T,{class:"d-flex justify-space-between"},{default:o(()=>[a(s).id?($(),A("span",ie,"Modifier une session")):($(),A("span",ue,"Enregistrer une session")),l(d,{onClick:e[5]||(e[5]=t=>p(u)?u.value=!1:u=!1),variant:"plain",icon:""},{default:o(()=>[l(r,null,{default:o(()=>[f("mdi-close")]),_:1})]),_:1})]),_:1}),l(B,null,{default:o(()=>[l(G,{modelValue:a(b),"onUpdate:modelValue":e[12]||(e[12]=t=>p(b)?b.value=t:b=t),onSubmit:e[13]||(e[13]=X(t=>H(),["prevent"])),class:"mt-5"},{default:o(()=>[l(Z,{modelValue:a(s).month,"onUpdate:modelValue":e[6]||(e[6]=t=>a(s).month=t),items:a(D),"item-title":"name","item-value":"slug",label:"Mois *","no-data-text":"Aucune donnée","closable-chips":"",chips:"",clearable:"","deletable-chips":"",variant:"outlined",rules:[t=>!!t||a(N)]},null,8,["modelValue","items","rules"]),l(C,{modelValue:a(s).year,"onUpdate:modelValue":e[7]||(e[7]=t=>a(s).year=t),label:"Année *",rules:[t=>!!t||a(N)],type:"text",variant:"outlined"},null,8,["modelValue","rules"]),l(C,{modelValue:a(s).reference,"onUpdate:modelValue":e[8]||(e[8]=t=>a(s).reference=t),label:"Reference",type:"text",variant:"outlined"},null,8,["modelValue"]),l(C,{modelValue:a(s).description,"onUpdate:modelValue":e[9]||(e[9]=t=>a(s).description=t),label:"Description",type:"text",variant:"outlined"},null,8,["modelValue"]),l(C,{modelValue:a(s).date_of_pv,"onUpdate:modelValue":e[10]||(e[10]=t=>a(s).date_of_pv=t),label:"Date du pv",type:"date",variant:"outlined"},null,8,["modelValue"]),i("div",re,[l(d,{color:"secondary",text:"",onClick:e[11]||(e[11]=t=>p(u)?u.value=!1:u=!1),variant:"outlined",class:"mr-2",disabled:a(k)},{default:o(()=>[f(" Fermer ")]),_:1},8,["disabled"]),l(d,{disabled:a(b)==!1,color:"#093e73",type:"submit",class:"text-white",loading:a(k)},{default:o(()=>[f(" Enregistrer ")]),_:1},8,["disabled","loading"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(z,{modelValue:a(_),"onUpdate:modelValue":e[18]||(e[18]=t=>p(_)?_.value=t:_=t),persistent:"","max-width":"500"},{default:o(()=>[l(O,null,{default:o(()=>[me,l(T,{class:"d-flex justify-space-between"},{default:o(()=>[ve,l(d,{onClick:e[15]||(e[15]=t=>p(_)?_.value=!1:_=!1),variant:"plain",icon:""},{default:o(()=>[l(r,null,{default:o(()=>[f("mdi-close")]),_:1})]),_:1})]),_:1}),l(B,null,{default:o(()=>[f(" Etes vous sur de vouloir supprimer votre sélection ? ")]),_:1}),i("div",_e,[i("div",fe,[l(d,{color:"#093e73",text:"",onClick:e[16]||(e[16]=t=>p(_)?_.value=!1:_=!1),variant:"outlined",class:"mr-2",disabled:a(h)},{default:o(()=>[f(" Non ")]),_:1},8,["disabled"]),l(d,{color:"red",type:"submit",class:"text-white",onClick:e[17]||(e[17]=t=>I()),loading:a(h)},{default:o(()=>[f(" Oui ")]),_:1},8,["loading"])])])]),_:1})]),_:1},8,["modelValue"])])])}}};export{ye as default};
